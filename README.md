# Бот в коробке

Это телеграм бот, который поставляется в одном контейнере с UI администратора, postgres и minio для хранения данных

## Keycloak (Внешняя зависимость)

Для запуска приложения потребуется иметь отдельно активированный и настроенный Keycloak для работы с UI администратора.

Требуется создать два клиента:

* Открытый, используемый для доступа к HTML страницам

* Закрытый, используемый для доступа к API

Для локальной отладки можно воспользоваться реалмом, сохранёнными в директории `keycloak`. В нём следует создать собственного пользователя, дополнительные настройки для него не нужны.

Реалм автоматически подключается при запуске контейнеров.

## Сборка контейнера

```bash
docker-compose build
docker-compose push
```

## Локальная сборка и отладка

Для работы потребуется запущенные сервисы `postgres` (порт 5432) и `minio` (порт 9000) с настройками пользователей, указанными в файле `.env.example` (пароли можно изменить).

Следует скопировать `.env.example` в файл `.env` и заполнить недостающие поля или изменить под текущее окружение.

Для того чтобы запустить БД и Minio для отладки (не запускать бота в контейнере) следует указать параметр `START_SERVICES=false` и выполнить `docker-compose up`.

Установка окружения:

```bash
poetry install
```

Запуск окружения:

```bash
poetry shell
```

Запуск UI администратора:

```bash
python src/ui/main.py
```

Запуск бота:

```bash
python src/bot/main.py
```

## Локальная отладка контейнера

Следует скопировать `.env.example` в файл `.env` и заполнить недостающие поля или изменить под текущее окружение.

```bash
docker-compose up
```